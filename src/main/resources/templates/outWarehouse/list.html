<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/outWarehouse/outWarehouse.css}">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        .modal-content {
            box-shadow: rgba(0,0,0,0.5) 0 0 0 9999px, rgba(0,0,0,0.5) 2px 2px 3px 3px !important;
        }

        #orderListModal-table{
            border-bottom: solid 1px black;
            width: 100%;
        }
    </style>
</head>
<body>
<th:block th:include="/common/header.html"></th:block>

<!-- 컨텐츠 작성 영역 -->
<div class="body-header">
    <div class="menu-title">출고 관리</div>
    <div class="menu-path"><a th:href="@{/}">메인페이지</a> / <a th:href="@{/franchiseorder/}">가맹점 발주 관리</a> / <a th:href="@{/outwarehouse/list}">출고 관리</a></div>
</div>
<br>

<!-- 상단박스 시작 -->
<div class="row">
    <div class="col-lg-3">
        <div class="ibox ">
            <div class="ibox-title">
                <h5>전체 출고</h5>
            </div>
            <div class="ibox-content">
                <h1 class="no-margins">3건</h1>
                <br>
            </div>
        </div>
    </div>

    <div class="col-lg-3">
        <div class="ibox ">
            <div class="ibox-title">
                <h5>출하 완료</h5>
            </div>
            <div class="ibox-content">
                <h1 class="no-margins">2건</h1>
                <br>
            </div>
        </div>
    </div>
</div>
<!-- 상단박스 끝 -->

<!-- 테이블 시작 -->
<div class="ibox-content" th:style="${'width:98%; margin:0 auto;'}">

    <h2 th:style="${'font-weight:bold;'}">출고 정보</h2>
    <br>

    <div th:style="${'vertical-align:middle;'}">
        <h4>가맹점 발주 상태 "완료" 목록 조회</h4>
        <button class="checkOrderListBtn btn btn-w-m btn-primary">조회</button>
    </div>

    <br>
    <table class="outWarehouseTbl footable table table-stripped" data-page-size="8" data-filter=#filter>
        <thead>
        <tr>
            <th>출고 번호</th>
            <th>작업상태</th>
            <th>작업 처리일자</th>
            <th>목적지(가맹점명)</th>
            <th>목적지(가맹점 주소)</th>
            <th>출고량</th>
            <th>상세 정보</th>
        </tr>
        </thead>
        <tbody>
<!--        <tr>-->
<!--            <td>2</td>-->
<!--            <td class="outWarehouseNo">20222022</td>-->
<!--            <td>출하 대기</td>-->
<!--            <td>2022-04-14</td>-->
<!--            <td>서울 강남 2호점</td>-->
<!--            <td>서울시 강남구</td>-->
<!--            <td>500</td>-->
<!--            <td>-->
<!--                <button type="button" class="detailBtn btn btn-w-m btn-primary" th:onclick="|javascript:viewDetail('${outWarehouseNo}')|">상세 조회</button>-->
<!--            </td>-->
<!--        </tr>-->
        <tr th:each="outWarehouse : ${ outWarehouseList }">
            <td th:text="${ outWarehouse.outWarehouseNo }"></td>
            <td th:text="${ outWarehouse.outWarehouseWorkingStatusName }"></td>
            <td th:text="${ outWarehouse.outWarehouseWorkingFinishedDate }"></td>
            <td th:text="${ outWarehouse.franchiseBranchName }"></td>
            <td th:text="${ outWarehouse.franchiseAddress }"></td>
            <td>
                <button type="button" class="detailBtn btn btn-w-m btn-primary" th:onclick="|javascript:viewDetail('${outWarehouse.outWarehouseNo}')|">상세 조회</button>
<!--                <button type="button" class="detailBtn btn btn-w-m btn-primary" th:onclick="'location.href=\'/outwarehouse/detail\''">상세 조회</button>-->
            </td>
        </tr>
        </tbody>
    </table>

    <div class="modal inmodal fade" id="orderListModal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content animated fadeIn" style="width: 1000px; right: 200px">
                <div class="modal-header">
                    <h4 class="modal-title">가맹점 발주 승인완료 목록</h4>
                    <button class="close" type="button" data-dismiss="modal">
                        <span aria-hidden="true">x</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- 조회해온 승인완료된 발주 목록 -->
                    <table id="orderListModal-table">
                        <th>
                            <td>발주번호</td>
                            <td>발주 요청 가맹점명</td>
                            <td>가맹점 주소</td>
                            <td>
<!--                                <button class="btn btn-primary">추가</button>-->
                                출고 추가 여부
                            </td>
                        </th>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="button" data-dismiss="modal" id="orderListModalCloseBtn">확인</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 테이블 끝 -->

<th:block th:replace="/common/footer.html"></th:block>

<script>
    const checkOrderListBtn = document.getElementsByClassName("checkOrderListBtn");
    const closeBtns = document.getElementsByClassName("close");
    const modalCloseBtn = document.getElementById("orderListModalCloseBtn");

    function viewDetail(num) {
        let No = num;
        location.href="/outwarehouse/detail/" + num;
    }

    checkOrderListBtn[0].onclick = function() {
        document.getElementById("orderListModal").style.display = "block";
        document.getElementById("orderListModal").classList.add("show");

        try {
            axios.get("/outwarehouse/orderlist")
            .then(function(res) {
                alert("조회 성공");
                console.log(res);
                console.log(res.data[0]);
            })
        } catch(e) {
            alert("조회 실패");
            console.log(e);
        }
    }

    for(let closeBtn of closeBtns) {
        closeBtn.onclick = function() {
            document.getElementById("orderListModal").style.display = "none";
        }
    }

    modalCloseBtn.onclick = function() {
        document.getElementById("orderListModal").style.display = "none";
    }
</script>
</body>
</html>